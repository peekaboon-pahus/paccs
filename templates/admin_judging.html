<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Judging Dashboard - PACCS Admin</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; min-height: 100vh; }
        
        .header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5em; font-weight: bold; color: #fff; text-decoration: none; }
        .logo span { color: #a855f7; }
        .nav-links a { color: rgba(255,255,255,0.8); text-decoration: none; padding: 8px 16px; margin-left: 10px; border-radius: 20px; }
        .nav-links a:hover { background: rgba(255,255,255,0.1); }
        
        .main { max-width: 1400px; margin: 0 auto; padding: 40px; }
        
        h1 { margin-bottom: 10px; }
        .subtitle { color: rgba(255,255,255,0.6); margin-bottom: 30px; }
        
        .stats { display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-bottom: 40px; }
        .stat { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 25px; text-align: center; }
        .stat .num { font-size: 2.5em; font-weight: bold; }
        .stat .num.purple { color: #a855f7; }
        .stat .num.yellow { color: #fbbf24; }
        .stat .num.green { color: #22c55e; }
        .stat .num.blue { color: #3b82f6; }
        .stat .num.red { color: #ef4444; }
        .stat .label { color: rgba(255,255,255,0.6); margin-top: 5px; }
        
        .controls { display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; align-items: center; }
        .tabs { display: flex; gap: 10px; }
        .tab { padding: 12px 25px; border-radius: 25px; border: none; background: rgba(255,255,255,0.1); color: white; cursor: pointer; font-size: 1em; }
        .tab.active { background: linear-gradient(135deg, #a855f7, #6366f1); }
        .search-box { flex: 1; max-width: 300px; padding: 12px 20px; border-radius: 25px; border: 2px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; font-size: 1em; }
        .search-box:focus { outline: none; border-color: #a855f7; }
        select { padding: 12px 20px; border-radius: 25px; border: 2px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; font-size: 1em; }
        select option { background: #1a1a2e; }
        
        .entries-list { display: flex; flex-direction: column; gap: 20px; }
        
        .entry-card { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 25px; display: grid; grid-template-columns: 120px 1fr 200px 180px; gap: 25px; align-items: center; border: 2px solid rgba(255,255,255,0.1); }
        .entry-card:hover { border-color: rgba(168,85,247,0.3); }
        .entry-card.winner { border-color: rgba(251,191,36,0.5); background: linear-gradient(135deg, rgba(251,191,36,0.1), rgba(251,191,36,0.02)); }
        
        .entry-thumbnail { width: 120px; height: 80px; background: linear-gradient(135deg, #1a1a2e, #2d1f3d); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2em; overflow: hidden; }
        .entry-thumbnail img { width: 100%; height: 100%; object-fit: cover; }
        
        .entry-info h3 { font-size: 1.2em; margin-bottom: 8px; }
        .entry-meta { color: rgba(255,255,255,0.5); font-size: 0.9em; margin-bottom: 10px; }
        .entry-meta span { margin-right: 15px; }
        .entry-category { display: inline-block; background: rgba(168,85,247,0.2); color: #a855f7; padding: 4px 12px; border-radius: 12px; font-size: 0.8em; margin-right: 10px; }
        .entry-status { display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 0.8em; font-weight: 600; }
        .status-pending { background: rgba(251,191,36,0.2); color: #fbbf24; }
        .status-reviewed { background: rgba(59,130,246,0.2); color: #3b82f6; }
        .status-selected { background: rgba(34,197,94,0.2); color: #22c55e; }
        .status-winner { background: rgba(251,191,36,0.3); color: #fbbf24; }
        .status-rejected { background: rgba(239,68,68,0.2); color: #ef4444; }
        
        .entry-scores { text-align: center; }
        .paccs-score { font-size: 2.5em; font-weight: bold; color: #22c55e; }
        .paccs-label { color: rgba(255,255,255,0.5); font-size: 0.85em; }
        .score-breakdown { display: flex; gap: 10px; margin-top: 10px; justify-content: center; }
        .mini-score { text-align: center; }
        .mini-score .val { font-size: 1.1em; font-weight: 600; color: #a855f7; }
        .mini-score .lbl { font-size: 0.7em; color: rgba(255,255,255,0.5); }
        
        .entry-actions { display: flex; flex-direction: column; gap: 8px; }
        .btn { padding: 10px 20px; border-radius: 20px; border: none; cursor: pointer; font-weight: 600; font-size: 0.9em; text-align: center; transition: all 0.2s; }
        .btn-winner { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #000; }
        .btn-select { background: linear-gradient(135deg, #22c55e, #16a34a); color: white; }
        .btn-onboard { background: linear-gradient(135deg, #a855f7, #6366f1); color: white; }
        .btn-view { background: rgba(255,255,255,0.1); color: white; }
        .btn-reject { background: rgba(239,68,68,0.2); color: #ef4444; }
        .btn:hover { transform: translateY(-2px); }
        
        .empty { text-align: center; padding: 80px; color: rgba(255,255,255,0.5); }
        .empty .icon { font-size: 4em; margin-bottom: 20px; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: #1a1a2e; border-radius: 20px; padding: 40px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .modal-header h2 { font-size: 1.5em; }
        .modal-close { background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; font-size: 1em; }
        .form-group textarea { min-height: 100px; }
        .score-input { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        .score-field { text-align: center; }
        .score-field input { text-align: center; font-size: 1.5em; font-weight: bold; }
        .score-field label { font-size: 0.8em; color: rgba(255,255,255,0.6); }
        
        @media (max-width: 1000px) {
            .stats { grid-template-columns: repeat(3, 1fr); }
            .entry-card { grid-template-columns: 1fr; text-align: center; }
            .entry-thumbnail { margin: 0 auto; }
            .entry-actions { flex-direction: row; justify-content: center; flex-wrap: wrap; }
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="/" class="logo">üé¨ <span>PACCS</span> Admin</a>
        <nav class="nav-links">
            <a href="/admin">Profiles</a>
            <a href="/admin-streaming">Streaming</a>
            <a href="/admin-music">Music</a>
            <a href="/admin-judging" style="background: rgba(168,85,247,0.2); color: #a855f7;">Judging</a>
            <a href="/festival">View Festival ‚Üí</a>
        </nav>
    </header>
    
    <main class="main">
        <h1>üèÜ Judging Dashboard</h1>
        <p class="subtitle">Review submissions, score films, select winners</p>
        
        <div class="stats">
            <div class="stat"><div class="num purple" id="totalEntries">0</div><div class="label">Total Entries</div></div>
            <div class="stat"><div class="num yellow" id="pendingEntries">0</div><div class="label">Pending Review</div></div>
            <div class="stat"><div class="num blue" id="reviewedEntries">0</div><div class="label">Reviewed</div></div>
            <div class="stat"><div class="num green" id="selectedEntries">0</div><div class="label">Selected</div></div>
            <div class="stat"><div class="num red" id="winnersCount">0</div><div class="label">Winners</div></div>
        </div>
        
        <div class="controls">
            <div class="tabs">
                <button class="tab active" onclick="filterEntries('all')">All</button>
                <button class="tab" onclick="filterEntries('pending')">Pending</button>
                <button class="tab" onclick="filterEntries('reviewed')">Reviewed</button>
                <button class="tab" onclick="filterEntries('selected')">Selected</button>
                <button class="tab" onclick="filterEntries('winner')">Winners</button>
            </div>
            <input type="text" class="search-box" placeholder="Search films..." onkeyup="searchEntries(this.value)">
            <select onchange="filterByCategory(this.value)">
                <option value="">All Categories</option>
                <option value="AI & Innovation">ü§ñ AI & Innovation</option>
                <option value="Social Impact">üåç Social Impact</option>
                <option value="Emerging Voices">üå± Emerging Voices</option>
                <option value="Cinema Excellence">üé¨ Cinema Excellence</option>
            </select>
        </div>
        
        <div class="entries-list" id="entriesList"></div>
    </main>
    
    <!-- Score Modal -->
    <div class="modal" id="scoreModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìä Score Entry</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                <div class="form-group">
                    <label>Film: <strong id="modalFilmTitle"></strong></label>
                </div>
                <div class="form-group">
                    <label>Score (0-100)</label>
                    <div class="score-input">
                        <div class="score-field">
                            <input type="number" id="scoreArtistic" min="0" max="100" value="70">
                            <label>Artistic</label>
                        </div>
                        <div class="score-field">
                            <input type="number" id="scoreMarket" min="0" max="100" value="70">
                            <label>Market</label>
                        </div>
                        <div class="score-field">
                            <input type="number" id="scoreTechnical" min="0" max="100" value="70">
                            <label>Technical</label>
                        </div>
                        <div class="score-field">
                            <input type="number" id="scoreImpact" min="0" max="100" value="70">
                            <label>Impact</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Judge Notes</label>
                    <textarea id="judgeNotes" placeholder="Your notes on this submission..."></textarea>
                </div>
                <div class="form-group">
                    <label>Decision</label>
                    <select id="judgeDecision">
                        <option value="reviewed">Mark as Reviewed</option>
                        <option value="selected">Select for Festival</option>
                        <option value="winner">Award Winner</option>
                        <option value="rejected">Reject</option>
                    </select>
                </div>
                <button class="btn btn-select" style="width:100%; margin-top:20px;" onclick="submitScore()">üíæ Save Score</button>
            </div>
        </div>
    </div>
    
    <script>
        var allEntries = [];
        var currentEntryId = null;
        
        function loadEntries() {
            fetch('/api/admin/entries')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    allEntries = data.entries || [];
                    updateStats();
                    renderEntries(allEntries);
                })
                .catch(function(e) {
                    console.error(e);
                    showEmpty();
                });
        }
        
        function updateStats() {
            document.getElementById('totalEntries').textContent = allEntries.length;
            document.getElementById('pendingEntries').textContent = allEntries.filter(function(e) { return e.status === 'pending'; }).length;
            document.getElementById('reviewedEntries').textContent = allEntries.filter(function(e) { return e.status === 'reviewed'; }).length;
            document.getElementById('selectedEntries').textContent = allEntries.filter(function(e) { return e.status === 'selected'; }).length;
            document.getElementById('winnersCount').textContent = allEntries.filter(function(e) { return e.status === 'winner'; }).length;
        }
        
        function renderEntries(entries) {
            var list = document.getElementById('entriesList');
            
            if (entries.length === 0) {
                showEmpty();
                return;
            }
            
            var html = '';
            entries.forEach(function(e) {
                var statusClass = 'status-' + e.status;
                var statusLabel = e.status.charAt(0).toUpperCase() + e.status.slice(1);
                var cardClass = e.status === 'winner' ? 'winner' : '';
                var avgScore = e.paccs_score || Math.round((e.score_artistic + e.score_market + e.score_technical + e.score_impact) / 4) || '--';
                
                html += '<div class="entry-card ' + cardClass + '">';
                html += '<div class="entry-thumbnail">';
                if (e.thumbnail) {
                    html += '<img src="' + e.thumbnail + '" alt="' + e.title + '">';
                } else {
                    html += 'üé¨';
                }
                html += '</div>';
                html += '<div class="entry-info">';
                html += '<h3>' + e.title + '</h3>';
                html += '<div class="entry-meta">';
                html += '<span>üé¨ ' + (e.director || 'Unknown Director') + '</span>';
                html += '<span>üåç ' + (e.country || 'N/A') + '</span>';
                html += '<span>‚è± ' + (e.duration || 'N/A') + '</span>';
                html += '</div>';
                html += '<span class="entry-category">' + getCategoryIcon(e.category) + ' ' + (e.category || 'Uncategorized') + '</span>';
                html += '<span class="entry-status ' + statusClass + '">' + statusLabel + '</span>';
                html += '</div>';
                html += '<div class="entry-scores">';
                html += '<div class="paccs-score">' + avgScore + '</div>';
                html += '<div class="paccs-label">PACCS Score</div>';
                if (e.score_artistic) {
                    html += '<div class="score-breakdown">';
                    html += '<div class="mini-score"><div class="val">' + e.score_artistic + '</div><div class="lbl">Art</div></div>';
                    html += '<div class="mini-score"><div class="val">' + e.score_market + '</div><div class="lbl">Mkt</div></div>';
                    html += '<div class="mini-score"><div class="val">' + e.score_technical + '</div><div class="lbl">Tech</div></div>';
                    html += '<div class="mini-score"><div class="val">' + e.score_impact + '</div><div class="lbl">Imp</div></div>';
                    html += '</div>';
                }
                html += '</div>';
                html += '<div class="entry-actions">';
                html += '<button class="btn btn-view" onclick="viewEntry(\'' + e.id + '\')">üëÅ View</button>';
                html += '<button class="btn btn-select" onclick="openScoreModal(\'' + e.id + '\')">üìä Score</button>';
                if (e.status === 'winner' || e.status === 'selected') {
                    html += '<button class="btn btn-onboard" onclick="onboardToStreaming(\'' + e.id + '\')">üì∫ Onboard</button>';
                }
                if (e.status !== 'winner') {
                    html += '<button class="btn btn-winner" onclick="makeWinner(\'' + e.id + '\')">üèÜ Winner</button>';
                }
                html += '</div></div>';
            });
            
            list.innerHTML = html;
        }
        
        function showEmpty() {
            document.getElementById('entriesList').innerHTML = 
                '<div class="empty">' +
                '<div class="icon">üì≠</div>' +
                '<h3>No Entries Yet</h3>' +
                '<p>Festival entries will appear here when imported from FilmFreeway or added manually.</p>' +
                '<button class="btn btn-onboard" onclick="addTestEntry()" style="margin-top:20px;">+ Add Test Entry</button>' +
                '</div>';
        }
        
        function getCategoryIcon(category) {
            var icons = { 'AI & Innovation': 'ü§ñ', 'Social Impact': 'üåç', 'Emerging Voices': 'üå±', 'Cinema Excellence': 'üé¨' };
            return icons[category] || 'üé¨';
        }
        
        function filterEntries(status) {
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            event.target.classList.add('active');
            
            if (status === 'all') {
                renderEntries(allEntries);
            } else {
                renderEntries(allEntries.filter(function(e) { return e.status === status; }));
            }
        }
        
        function searchEntries(query) {
            if (!query) {
                renderEntries(allEntries);
                return;
            }
            query = query.toLowerCase();
            renderEntries(allEntries.filter(function(e) {
                return e.title.toLowerCase().indexOf(query) >= 0 || 
                       (e.director || '').toLowerCase().indexOf(query) >= 0;
            }));
        }
        
        function filterByCategory(category) {
            if (!category) {
                renderEntries(allEntries);
                return;
            }
            renderEntries(allEntries.filter(function(e) { return e.category === category; }));
        }
        
        function openScoreModal(id) {
            currentEntryId = id;
            var entry = allEntries.find(function(e) { return e.id === id; });
            if (!entry) return;
            
            document.getElementById('modalFilmTitle').textContent = entry.title;
            document.getElementById('scoreArtistic').value = entry.score_artistic || 70;
            document.getElementById('scoreMarket').value = entry.score_market || 70;
            document.getElementById('scoreTechnical').value = entry.score_technical || 70;
            document.getElementById('scoreImpact').value = entry.score_impact || 70;
            document.getElementById('judgeNotes').value = entry.judge_notes || '';
            document.getElementById('judgeDecision').value = entry.status || 'reviewed';
            
            document.getElementById('scoreModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('scoreModal').classList.remove('active');
            currentEntryId = null;
        }
        
        function submitScore() {
            if (!currentEntryId) return;
            
            var data = {
                score_artistic: parseInt(document.getElementById('scoreArtistic').value),
                score_market: parseInt(document.getElementById('scoreMarket').value),
                score_technical: parseInt(document.getElementById('scoreTechnical').value),
                score_impact: parseInt(document.getElementById('scoreImpact').value),
                judge_notes: document.getElementById('judgeNotes').value,
                status: document.getElementById('judgeDecision').value
            };
            
            fetch('/api/admin/entries/' + currentEntryId + '/score', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(function(r) { return r.json(); })
            .then(function(result) {
                if (result.success) {
                    alert('Score saved!');
                    closeModal();
                    loadEntries();
                } else {
                    alert('Error saving score');
                }
            })
            .catch(function(e) { alert('Error: ' + e); });
        }
        
        function makeWinner(id) {
            if (!confirm('Make this entry a winner?')) return;
            
            fetch('/api/admin/entries/' + id + '/winner', { method: 'POST' })
                .then(function(r) { return r.json(); })
                .then(function(result) {
                    if (result.success) {
                        alert('Winner selected!');
                        loadEntries();
                    }
                });
        }
        
        function onboardToStreaming(id) {
            var entry = allEntries.find(function(e) { return e.id === id; });
            if (!entry) return;
            
            if (confirm('Onboard "' + entry.title + '" to streaming platform?')) {
                fetch('/api/admin/entries/' + id + '/onboard', { method: 'POST' })
                    .then(function(r) { return r.json(); })
                    .then(function(result) {
                        if (result.success) {
                            alert('Film added to streaming! ID: ' + result.streaming_id);
                            loadEntries();
                        } else {
                            alert('Error: ' + (result.error || 'Unknown error'));
                        }
                    });
            }
        }
        
        function viewEntry(id) {
            var entry = allEntries.find(function(e) { return e.id === id; });
            if (!entry) return;
            
            if (entry.video_url) {
                window.open(entry.video_url, '_blank');
            } else if (entry.streaming_id) {
                window.location = '/watch/' + entry.streaming_id;
            } else {
                alert('No video URL available for this entry.');
            }
        }
        
        function addTestEntry() {
            var testEntry = {
                title: 'Test Film ' + Math.floor(Math.random() * 1000),
                director: 'Test Director',
                country: 'United Kingdom',
                duration: '15 min',
                category: ['AI & Innovation', 'Social Impact', 'Emerging Voices', 'Cinema Excellence'][Math.floor(Math.random() * 4)],
                video_url: 'https://vimeo.com/example',
                filmmaker_email: 'test@example.com'
            };
            
            fetch('/api/admin/entries/add', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(testEntry)
            })
            .then(function(r) { return r.json(); })
            .then(function(result) {
                if (result.success) {
                    loadEntries();
                }
            });
        }
        
        loadEntries();
    </script>
</body>
</html>