<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Films - PACCS Streaming</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0a0a0a; color: #fff; min-height: 100vh; }
        .header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .logo { font-size: 1.5em; font-weight: bold; color: #fff; text-decoration: none; }
        .logo span { color: #a855f7; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: rgba(255,255,255,0.8); text-decoration: none; padding: 8px 16px; border-radius: 20px; transition: all 0.2s; }
        .nav-links a:hover { background: rgba(255,255,255,0.1); }
        .nav-links a.active { background: rgba(168,85,247,0.3); }
        .hero { background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1a 100%); padding: 60px 40px; text-align: center; }
        .hero h1 { font-size: 3em; margin-bottom: 15px; }
        .hero h1 span { color: #a855f7; }
        .hero p { color: rgba(255,255,255,0.7); font-size: 1.1em; max-width: 600px; margin: 0 auto 30px; }
        .search-bar { max-width: 500px; margin: 0 auto; display: flex; gap: 10px; }
        .search-bar input { flex: 1; padding: 15px 20px; border-radius: 25px; border: 2px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: white; font-size: 1em; }
        .search-bar input:focus { outline: none; border-color: #a855f7; }
        .search-bar button { padding: 15px 25px; border-radius: 25px; border: none; background: linear-gradient(135deg, #a855f7, #7c3aed); color: white; font-weight: 600; cursor: pointer; }
        .main-content { max-width: 1400px; margin: 0 auto; padding: 40px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .section-header h2 { font-size: 1.6em; }
        .films-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; margin-bottom: 50px; }
        .film-card { background: rgba(255,255,255,0.05); border-radius: 15px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s; cursor: pointer; }
        .film-card:hover { transform: translateY(-8px); border-color: rgba(168,85,247,0.5); }
        .film-thumb { height: 160px; background: linear-gradient(135deg, #1a1a2e, #2d1f3d); display: flex; align-items: center; justify-content: center; font-size: 3em; position: relative; }
        .film-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .film-thumb .price { position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #22c55e, #16a34a); padding: 5px 12px; border-radius: 15px; font-size: 0.85em; font-weight: 600; }
        .film-thumb .free { background: linear-gradient(135deg, #a855f7, #7c3aed); }
        .film-info { padding: 20px; }
        .film-info h3 { font-size: 1.1em; margin-bottom: 8px; }
        .film-meta { color: rgba(255,255,255,0.5); font-size: 0.85em; margin-bottom: 8px; }
        .film-filmmaker { color: #a855f7; font-size: 0.9em; }
        .empty-state { text-align: center; padding: 80px; color: rgba(255,255,255,0.5); }
        .empty-state .icon { font-size: 4em; margin-bottom: 20px; }
        .upload-cta { background: linear-gradient(135deg, rgba(168,85,247,0.2), rgba(124,58,237,0.1)); border: 2px dashed rgba(168,85,247,0.5); border-radius: 20px; padding: 50px; text-align: center; margin-top: 40px; }
        .upload-cta h3 { margin-bottom: 10px; }
        .upload-cta p { color: rgba(255,255,255,0.6); margin-bottom: 20px; }
        .btn { display: inline-block; background: linear-gradient(135deg, #a855f7, #7c3aed); color: white; padding: 15px 30px; border-radius: 25px; text-decoration: none; font-weight: 600; }
        @media (max-width: 600px) { .header { padding: 15px 20px; } .hero { padding: 40px 20px; } .hero h1 { font-size: 2em; } .main-content { padding: 20px; } }
    </style>
</head>
<body>
    <header class="header">
        <a href="/" class="logo">üé¨ <span>PACCS</span></a>
        <nav class="nav-links">
            <a href="/festival">Festival</a>
            <a href="/watch" class="active">Streaming</a>
            <a href="/music-browse">Music</a>
            <a href="/filmmakers">Filmmakers</a>
            <a href="/dashboard">Dashboard</a>
        </nav>
    </header>
    
    <section class="hero">
        <h1>Watch <span>Independent Films</span></h1>
        <p>Stream amazing films from talented filmmakers worldwide. Rent for 48 hours or watch free content.</p>
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search films..." onkeypress="if(event.key==='Enter')searchFilms()">
            <button onclick="searchFilms()">üîç</button>
        </div>
    </section>
    
    <main class="main-content">
        <section>
            <div class="section-header">
                <h2>üé¨ Available Films</h2>
                <span id="filmCount">Loading...</span>
            </div>
            <div class="films-grid" id="filmsGrid"></div>
        </section>
        
        <section class="upload-cta">
            <h3>üé¨ Are You a Filmmaker?</h3>
            <p>Upload your film and earn 70% of every rental. Set your own price and reach global audiences.</p>
            <a href="/upload" class="btn">Upload Your Film ‚Üí</a>
        </section>
    </main>
    
    <script>
        let allFilms = [];
        
        async function loadFilms() {
            try {
                const response = await fetch('/api/streaming/films');
                const data = await response.json();
                allFilms = data.films || [];
                renderFilms(allFilms);
            } catch (error) {
                console.error('Error:', error);
                showEmpty();
            }
        }
        
        function renderFilms(films) {
            const grid = document.getElementById('filmsGrid');
            document.getElementById('filmCount').textContent = films.length + ' films';
            
            if (films.length === 0) { showEmpty(); return; }
            
            grid.innerHTML = films.map(f => `
                <div class="film-card" onclick="window.location='/watch/${f.id}'">
                    <div class="film-thumb">
                        ${f.thumbnail ? `<img src="${f.thumbnail}" alt="${f.title}">` : 'üé¨'}
                        <span class="price ${f.price === 0 ? 'free' : ''}">${f.price === 0 ? 'FREE' : '¬£' + f.price}</span>
                    </div>
                    <div class="film-info">
                        <h3>${f.title}</h3>
                        <div class="film-meta">${f.genre || 'Film'} ‚Ä¢ ${f.duration || '90 min'} ‚Ä¢ ${f.year || '2024'}</div>
                        <div class="film-filmmaker">${f.filmmaker || 'Independent Filmmaker'}</div>
                    </div>
                </div>
            `).join('');
        }
        
        function showEmpty() {
            document.getElementById('filmsGrid').innerHTML = `
                <div class="empty-state" style="grid-column: 1/-1;">
                    <div class="icon">üé¨</div>
                    <h3>No Films Yet</h3>
                    <p>Be the first to upload your film!</p>
                    <a href="/upload" class="btn" style="margin-top: 20px;">Upload Film</a>
                </div>`;
        }
        
@app.route('/streaming')
def streaming_page(): return render_template('watch.html')

        function searchFilms() {
            const q = document.getElementById('searchInput').value.toLowerCase();
            renderFilms(q ? allFilms.filter(f => f.title.toLowerCase().includes(q) || (f.filmmaker || '').toLowerCase().includes(q)) : allFilms);
        }
        
        loadFilms();
    </script>
</body>
</html>