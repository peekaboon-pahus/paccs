<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PACCS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
        }
        .header {
            background: #1a1a2e;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.5em; font-weight: bold; }
        .logo span { color: #a855f7; }
        .admin-badge {
            background: #ef4444;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
        }
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
        }
        h1 { margin-bottom: 10px; }
        .subtitle { color: rgba(255,255,255,0.6); margin-bottom: 30px; }
        .ai-banner {
            background: linear-gradient(135deg, rgba(168,85,247,0.2), rgba(59,130,246,0.2));
            border: 1px solid rgba(168,85,247,0.3);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .ai-banner .icon { font-size: 2em; }
        .ai-banner h3 { color: #a855f7; margin-bottom: 5px; }
        .ai-banner p { color: rgba(255,255,255,0.7); font-size: 0.9em; }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        .stat-value { font-size: 2.5em; font-weight: bold; }
        .stat-value.green { color: #22c55e; }
        .stat-value.yellow { color: #f59e0b; }
        .stat-value.red { color: #ef4444; }
        .stat-value.purple { color: #a855f7; }
        .stat-label { color: rgba(255,255,255,0.6); margin-top: 5px; }
        .profiles-list { display: flex; flex-direction: column; gap: 15px; }
        .profile-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .profile-card.flagged { border: 1px solid rgba(239,68,68,0.5); }
        .profile-left { display: flex; align-items: center; gap: 15px; }
        .avatar {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
        }
        .profile-info h3 { margin-bottom: 5px; }
        .profile-meta { color: rgba(255,255,255,0.5); font-size: 0.9em; }
        .profile-right { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
        .score {
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .score.high { background: rgba(34,197,94,0.2); color: #22c55e; }
        .score.medium { background: rgba(245,158,11,0.2); color: #f59e0b; }
        .score.low { background: rgba(239,68,68,0.2); color: #ef4444; }
        .status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
        }
        .status.auto { background: rgba(34,197,94,0.2); color: #22c55e; }
        .status.pending { background: rgba(245,158,11,0.2); color: #f59e0b; }
        .status.flagged { background: rgba(239,68,68,0.2); color: #ef4444; }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9em;
        }
        .btn-approve { background: #22c55e; color: white; }
        .btn-feature { background: #a855f7; color: white; }
        .btn-view { background: #3b82f6; color: white; }
        .btn-reject { background: #ef4444; color: white; }
        .flags { margin-top: 10px; width: 100%; }
        .flag {
            display: inline-block;
            background: rgba(239,68,68,0.15);
            color: #fca5a5;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 0.8em;
            margin-right: 8px;
            margin-bottom: 5px;
        }
        .empty { text-align: center; padding: 60px; color: rgba(255,255,255,0.5); }
        .empty .icon { font-size: 4em; margin-bottom: 15px; }
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }
        .toast.success { background: #22c55e; color: white; }
        @media (max-width: 768px) {
            .stats-row { grid-template-columns: repeat(2, 1fr); }
            .main-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">üé¨ <span>PACCS</span></div>
        <span class="admin-badge">üîê Admin</span>
    </header>
    
    <main class="main-content">
        <h1>Profile Management</h1>
        <p class="subtitle">AI-powered moderation with manual override</p>
        
        <div class="ai-banner">
            <div class="icon">ü§ñ</div>
            <div>
                <h3>AI Moderation Active</h3>
                <p>Score ‚â•80 = Auto-approved ‚Ä¢ 50-79 = Needs review ‚Ä¢ &lt;50 = Flagged</p>
            </div>
        </div>
        
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value green" id="autoCount">0</div>
                <div class="stat-label">Auto-Approved</div>
            </div>
            <div class="stat-card">
                <div class="stat-value yellow" id="pendingCount">0</div>
                <div class="stat-label">Needs Review</div>
            </div>
            <div class="stat-card">
                <div class="stat-value red" id="flaggedCount">0</div>
                <div class="stat-label">Flagged</div>
            </div>
            <div class="stat-card">
                <div class="stat-value purple" id="totalCount">0</div>
                <div class="stat-label">Total</div>
            </div>
        </div>
        
        <div id="profilesList" class="profiles-list">
            <div class="empty">
                <div class="icon">‚è≥</div>
                <p>Loading profiles...</p>
            </div>
        </div>
    </main>
    
    <div class="toast" id="toast"></div>
    
    <script>
        async function loadProfiles() {
            try {
                const response = await fetch('/api/admin/profiles');
                const data = await response.json();
                
                if (data.success && data.profiles) {
                    updateStats(data.profiles);
                    renderProfiles(data.profiles);
                } else {
                    showEmpty('No profiles yet');
                }
            } catch (error) {
                console.error('Error:', error);
                showEmpty('Error loading profiles');
            }
        }
        
        function updateStats(profiles) {
            const auto = profiles.filter(p => p.status === 'auto_approved').length;
            const pending = profiles.filter(p => p.status === 'pending_review').length;
            const flagged = profiles.filter(p => p.status === 'flagged').length;
            
            document.getElementById('autoCount').textContent = auto;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('flaggedCount').textContent = flagged;
            document.getElementById('totalCount').textContent = profiles.length;
        }
        
        function renderProfiles(profiles) {
            const container = document.getElementById('profilesList');
            
            if (profiles.length === 0) {
                showEmpty('No profiles yet. Share your signup link!');
                return;
            }
            
            let html = '';
            profiles.forEach(p => {
                const score = p.moderation_score || 0;
                const scoreClass = score >= 80 ? 'high' : score >= 50 ? 'medium' : 'low';
                const statusClass = p.status === 'auto_approved' ? 'auto' : p.status === 'pending_review' ? 'pending' : 'flagged';
                const statusText = p.status === 'auto_approved' ? '‚úì Auto' : p.status === 'pending_review' ? '‚è≥ Review' : 'üö© Flagged';
                const flags = p.moderation_flags || [];
                const isFlagged = p.status === 'flagged' ? 'flagged' : '';
                
                html += '<div class="profile-card ' + isFlagged + '">';
                html += '<div class="profile-left">';
                html += '<div class="avatar">' + (p.fullName ? p.fullName[0] : '?') + '</div>';
                html += '<div class="profile-info">';
                html += '<h3>' + (p.featured ? '‚≠ê ' : '') + (p.fullName || 'Unknown') + '</h3>';
                html += '<div class="profile-meta">' + (p.designation || 'Filmmaker') + ' ‚Ä¢ ' + (p.email || '') + '</div>';
                html += '</div></div>';
                
                html += '<div class="profile-right">';
                html += '<span class="score ' + scoreClass + '">ü§ñ ' + score + '%</span>';
                html += '<span class="status ' + statusClass + '">' + statusText + '</span>';
                html += '<button class="btn btn-view" onclick="viewProfile(\'' + p.id + '\')">View</button>';
                
                if (p.status !== 'approved' && p.status !== 'auto_approved') {
                    html += '<button class="btn btn-approve" onclick="approveProfile(\'' + p.id + '\')">Approve</button>';
                }
                if (!p.featured) {
                    html += '<button class="btn btn-feature" onclick="featureProfile(\'' + p.id + '\')">Feature</button>';
                }
                html += '</div>';
                
                if (flags.length > 0) {
                    html += '<div class="flags">';
                    flags.forEach(f => {
                        html += '<span class="flag">‚ö†Ô∏è ' + formatFlag(f) + '</span>';
                    });
                    html += '</div>';
                }
                
                html += '</div>';
            });
            
            container.innerHTML = html;
        }
        
        function formatFlag(flag) {
            const labels = {
                'offensive_language': 'Offensive Language',
                'spam_detected': 'Spam',
                'low_quality_bio': 'Low Quality Bio',
                'short_bio': 'Short Bio',
                'suspicious_name': 'Suspicious Name',
                'placeholder_content': 'Placeholder Content'
            };
            return labels[flag] || flag;
        }
        
        function showEmpty(message) {
            document.getElementById('profilesList').innerHTML = 
                '<div class="empty"><div class="icon">üì≠</div><p>' + message + '</p></div>';
        }
        
        function viewProfile(id) {
            window.open('/filmmaker/' + id, '_blank');
        }
        
        async function approveProfile(id) {
            const res = await fetch('/api/admin/profile/' + id + '/approve', { method: 'POST' });
            if (res.ok) {
                showToast('Profile approved! ‚úì');
                loadProfiles();
            }
        }
        
        async function featureProfile(id) {
            const res = await fetch('/api/admin/profile/' + id + '/feature', { method: 'POST' });
            if (res.ok) {
                showToast('Profile featured! ‚≠ê');
                loadProfiles();
            }
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast success';
            toast.style.display = 'block';
            setTimeout(() => { toast.style.display = 'none'; }, 3000);
        }
        
        loadProfiles();
    </script>
</body>
</html>