<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - PACCS</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            min-height: 100vh;
        }
        .header {
            background: #1a1a2e;
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo { font-size: 1.5em; font-weight: bold; }
        .logo span { color: #a855f7; }
        .admin-badge {
            background: #ef4444;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
        }
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
        }
        h1 { margin-bottom: 30px; }
        .stats-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        .stat-value { font-size: 2.5em; font-weight: bold; color: #a855f7; }
        .stat-label { color: rgba(255,255,255,0.6); }
        .profiles-list { display: flex; flex-direction: column; gap: 15px; }
        .profile-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .profile-info h3 { margin-bottom: 5px; }
        .profile-meta { color: rgba(255,255,255,0.5); font-size: 0.9em; }
        .score { padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .score.high { background: rgba(34,197,94,0.2); color: #22c55e; }
        .score.medium { background: rgba(245,158,11,0.2); color: #f59e0b; }
        .score.low { background: rgba(239,68,68,0.2); color: #ef4444; }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin-left: 10px;
        }
        .btn-approve { background: #22c55e; color: white; }
        .btn-feature { background: #a855f7; color: white; }
        .btn-view { background: #3b82f6; color: white; }
        .empty { text-align: center; padding: 60px; color: rgba(255,255,255,0.5); }
        .flags { margin-top: 10px; }
        .flag { display: inline-block; background: rgba(239,68,68,0.2); color: #fca5a5; padding: 3px 10px; border-radius: 10px; font-size: 0.8em; margin-right: 5px; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">üé¨ <span>PACCS</span></div>
        <span class="admin-badge">üîê Admin</span>
    </header>
    
    <main class="main-content">
        <h1>Profile Management</h1>
        
        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-value" id="autoCount">0</div>
                <div class="stat-label">Auto-Approved</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pendingCount">0</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="flaggedCount">0</div>
                <div class="stat-label">Flagged</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalCount">0</div>
                <div class="stat-label">Total</div>
            </div>
        </div>
        
        <div id="profilesList" class="profiles-list">
            <div class="empty">Loading profiles...</div>
        </div>
    </main>
    
    <script>
        async function loadProfiles() {
            try {
                const response = await fetch('/api/admin/profiles');
                const data = await response.json();
                
                if (data.success && data.profiles) {
                    updateStats(data.profiles);
                    renderProfiles(data.profiles);
                } else {
                    document.getElementById('profilesList').innerHTML = '<div class="empty">No profiles yet</div>';
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('profilesList').innerHTML = '<div class="empty">Error loading profiles</div>';
            }
        }
        
        function updateStats(profiles) {
            const auto = profiles.filter(p => p.status === 'auto_approved').length;
            const pending = profiles.filter(p => p.status === 'pending_review').length;
            const flagged = profiles.filter(p => p.status === 'flagged').length;
            
            document.getElementById('autoCount').textContent = auto;
            document.getElementById('pendingCount').textContent = pending;
            document.getElementById('flaggedCount').textContent = flagged;
            document.getElementById('totalCount').textContent = profiles.length;
        }
        
        function renderProfiles(profiles) {
            const container = document.getElementById('profilesList');
            
            if (profiles.length === 0) {
                container.innerHTML = '<div class="empty">No profiles yet. Share your signup link!</div>';
                return;
            }
            
            container.innerHTML = profiles.map(p => {
                const scoreClass = p.moderation_score >= 80 ? 'high' : p.moderation_score >= 50 ? 'medium' : 'low';
                const flags = p.moderation_flags || [];
                
                return '<div class="profile-card">' +
                    '<div class="profile-info">' +
                        '<h3>' + (p.fullName || 'Unknown') + '</h3>' +
                        '<div class="profile-meta">' + (p.designation || 'Filmmaker') + ' ‚Ä¢ ' + (p.email || '') + '</div>' +
                        (flags.length > 0 ? '<div class="flags">' + flags.map(f => '<span class="flag">' + f + '</span>').join('') + '</div>' : '') +
                    '</div>' +
                    '<div>' +
                        '<span class="score ' + scoreClass + '">AI: ' + (p.moderation_score || 0) + '%</span>' +
                        '<button class="btn btn-view" onclick="window.open(\'/filmmaker/' + p.id + '\')">View</button>' +
                        '<button class="btn btn-approve" onclick="approveProfile(\'' + p.id + '\')">Approve</button>' +
                        '<button class="btn btn-feature" onclick="featureProfile(\'' + p.id + '\')">Feature</button>' +
                    '</div>' +
                '</div>';
            }).join('');
        }
        
        async function approveProfile(id) {
            await fetch('/api/admin/profile/' + id + '/approve', { method: 'POST' });
            loadProfiles();
        }
        
        async function featureProfile(id) {
            await fetch('/api/admin/profile/' + id + '/feature', { method: 'POST' });
            loadProfiles();
        }
        
        loadProfiles();
    </script>
</body>
</html>